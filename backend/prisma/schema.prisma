// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
	id 			Int @id @default(autoincrement())
	createdAt 	DateTime @default(now())
	updateAt 	DateTime @updatedAt

	name		String @unique // 42 login

	token42 	Json
	jwt			String?
	pseudo 		String? @unique
	//friends 	User[]
	channelsOwn	Channel[] @relation("channel_owner")
	channelsAdmin ChannelAdmins[]
	status 		String?
	//history	Game[]
	nb_win		Int @default(0)
	nb_loose	Int @default(0) 
	nb_game		Int @default(0)
	total_point	Int @default(0)
	level		Int @default(0)
	rank		Int @default(0)
	avatar		String?
	twoFA		Boolean  @default(false)
	//notifs		String []
	messages	Message[]
}

model	Channel {
	id 			Int @id @default(autoincrement())
	createdAt 	DateTime @default(now())
	updateAt 	DateTime @updatedAt

	name		String	@unique
	hash		String?
	private		Boolean @default(false)
	
	owner		User @relation(name: "channel_owner", fields: [ownerId], references: [id])
	ownerId		Int

	admins		ChannelAdmins[]
	messages	Message[]
}

// Relation tables for many-to-many relations
model ChannelAdmins {
  channelId Int
  channel Channel @relation(fields: [channelId], references: [id])

  userId    Int
  user    User @relation(fields: [userId], references: [id])

  @@id([channelId, userId])
}

model	Message {
	id 			Int @id @default(autoincrement())
	sendAt		DateTime @default(now())
	sendBy		User	@relation(fields: [sendById], references: [id])
	sendById	Int
	channel		Channel @relation(fields: [channelId], references: [id])
	channelId	Int
	content		String
}

model	Game {
	id 			Int @id @default(autoincrement())
	createdAt 	DateTime @default(now())
	endAt 		DateTime?

	live		Boolean
	//creator		User
	//guest			User
	winnerId	Int?
	looserId	Int?
	scoreCreator Int @default(0)
	scoreGuest	Int	@default(0)
	//socket ? 
	//theme		String ou Url ? (same avatar)
	difficulty	Int @default(1)
	matchmaking	Boolean
}

// Use "npx prisma generate" = create TSClass from Schema for our code.
// => import { User } from '@prisma/client';
